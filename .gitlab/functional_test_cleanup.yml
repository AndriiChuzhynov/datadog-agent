---
# functional_test_cleanup stage
# Contains a job which cleans up kitchen resources created for functional tests.

# FIXME: our current Gitlab version doesn't support importing a file more than once
# For now, the workaround is to include "common" files once in the top-level .gitlab-ci.yml file
# See: https://gitlab.com/gitlab-org/gitlab/-/issues/28987
# include:
#   - /.gitlab/kitchen_common/cleanup.yml

cleanup_kitchen_functional_test:
  extends: .kitchen_cleanup_azure_common
  stage: functional_test_cleanup
  needs:
    - job: kitchen_test_system_probe_linux_x64
      optional: true
    - job: kitchen_test_system_probe_linux_arm64
      optional: true
    - job: kitchen_test_system_probe_windows_x64
      optional: true
    - job: kitchen_test_security_agent_x64
      optional: true
    - job: kitchen_test_security_agent_arm64
      optional: true
    - job: kitchen_stress_security_agent
      optional: true
  variables:
    DD_PIPELINE_ID: $CI_PIPELINE_ID-a7
